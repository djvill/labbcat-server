<h1 i18n>Participants</h1>
<div id="spinner"><lib-wait *ngIf="loadingList || listParticipantsTimer >= 0"></lib-wait></div>
<div class="participants">
  <table>
    <thead>
      <tr class="filters">
        <td *ngFor="let layer of filterLayers" class="{{layer.id}}">
          <lib-layer-filter            
            [layer]="layer"
            [values]="filterValues[layer.id]"
            (changeValues)="filterChange(layer, $event)"
            ></lib-layer-filter>
        </td>
      </tr><!-- Select from file -->
      <tr class="controls">
        <td colSpan="{{filterLayers.length}}">
          <lib-button
            *ngIf="user && user.roles.includes('edit')"
            action="create"
            (press)="newParticipant()"
            i18n-title title="New record"
            ></lib-button>
          <lib-button
            *ngIf="user && user.roles.includes('edit')"
            action="delete"
            (press)="deleteParticipants()" [processing]="deleting"
            [disabled]="selectedIds.length == 0"
            i18n-title title="Delete record"
            ></lib-button>
          <lib-button
            *ngIf="user && user.roles.includes('edit')"
            (press)="mergeParticipants()"
            [disabled]="selectedIds.length < 2"
            img="people.svg" icon="👥"
            i18n-label label="Merge"
            i18n-title title="Merge selected participant records into one record"
            ></lib-button>
          <lib-button
            (press)="allUtterances()"
            [disabled]="selectedIds.length == 0"
            img="all-utterances.svg" icon="“"
            i18n-label label="All Utterances"
            i18n-title title="List all utterances by these participants"
            ></lib-button>
          <lib-button
            (press)="exportAttributes()"
            [disabled]="!participantIds || participantIds.length == 0"
            img="csv.svg" icon=",a,"
            i18n-label label="Export Attributes"
            i18n-title title="Export attributes to CSV"
            ></lib-button>
          <lib-button
            (press)="layeredSearch()"
            [disabled]="!participantIds || participantIds.length == 0"
            img="magnifying-glass.svg" icon="🔍"
            i18n-label label="Layered Search"
            i18n-title title="Search transcripts including these participants"
            ></lib-button>
        </td>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let id of participantIds">
        <td *ngFor="let layer of filterLayers" class="{{layer.id}}">
          <span class="id" *ngIf="layer.id == schema.participantLayerId">
            <lib-grouped-checkbox
              group="participant"
              name="id"
              value="{{id}}"
              [checked]="selectedIds.includes(id)"
              (checkedChange)="selectedIds.includes(id)?selectedIds.splice(selectedIds.indexOf(id),1):selectedIds.push(id)"></lib-grouped-checkbox>
            <a href="participant?id={{id}}" title="{{id}}">{{id}}</a>
          </span>
          <span class="attribute" *ngIf="layer.id != schema.participantLayerId && attributeValues[id].annotations">

            <span class="value" *ngFor="let annotation of attributeValues[id].annotations[layer.id]" title="{{layer.id}}: {{annotation.label}}">
              <span class="{{layer.subtype}}"
                    *ngIf="layer.subtype != 'datetime' && layer.subtype != 'date'">
                {{annotation.label}}</span>
              <span class="{{layer.subtype}}"
                    *ngIf="layer.subtype == 'date'"
                    title="{{annotation.label | date : 'fullDate' }}">
                {{annotation.label}}</span>
              <span class="{{layer.subtype}}"
                    *ngIf="layer.subtype == 'datetime'"
                    title="{{annotation.label | date : 'full' }}">
                {{annotation.label}}</span>
            </span>
          </span>
        </td>
      </tr>
    </tbody>
  </table>
</div>
<lib-pagination
  i18n-title title="Page links"
  [currentPage]="p"
  [pageLinks]="pageLinks"
  (goToPage)="goToPage($event)"></lib-pagination>
